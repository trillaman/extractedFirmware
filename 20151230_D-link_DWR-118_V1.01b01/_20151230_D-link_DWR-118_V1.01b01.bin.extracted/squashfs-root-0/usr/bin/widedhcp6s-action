#!/bin/sh

# Paths to programs
UVM=/usr/bin/uvm
UO_PATH=/usr/uo/
UO_FILE=dhcp6s.wide.conf.uo
UO_CONF=dhcp6s.wide.conf
DHCP6S_IF=$(rdcsman 0x8000f201 str)

start() {
	PIDFILE="/var/run/dhcp6s.pid"
	#check dhcp6s is runniing or not
	if [ -r "$PIDFILE" ] ; then
		PID=`cat "$PIDFILE"`
		#check if still running
		kill -0 $PID > /dev/null 2>&1
		if [ $? = 0 ] ; then
			echo "$0: another dhcpv6c connection up (PID $PID)" >& 2
			exit 0
		fi
		rm -f "$PIDFILE"
	fi

    local err; err=0
    ($UVM $UO_PATH/$UO_FILE > /etc/$UO_CONF || $err=1);
    wide-dhcp6s -c /etc/dhcp6s.wide.conf $DHCP6S_IF
    return $err
}

stop() {
	kill $(cat /var/run/dhcp6s.pid)

    local err; err=0
    return $err
}


usage() {
    echo "$0 [start|stop|restart]"
    exit 1
}

[ -z "$1" ] && usage;

err=0

case "$1" in
    start)      start;;
    stop)       stop;;
    restart)    stop; start;;
    *)      usage;;
esac

exit $err


